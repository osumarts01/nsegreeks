<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>NIFTY Greeks</title>

<style>
body{
  margin:0;
  height:100vh;
  background:radial-gradient(circle at top,#0b1a33,#050b16);
  color:#fff;
  font-family:Arial, sans-serif;
  display:flex;
  justify-content:center;
  align-items:center;
}

.card{
  width:520px;
  background:rgba(20,30,55,.55);
  border-radius:16px;
  padding:22px;
  box-shadow:0 20px 60px rgba(0,0,0,.6);
  backdrop-filter:blur(14px);
}

h1{
  text-align:center;
  margin:0 0 12px;
  color:#6fb4ff;
}

table{
  width:100%;
  border-collapse:collapse;
}

th,td{
  padding:10px;
  text-align:right;
}

th:first-child,td:first-child{
  text-align:left;
}

tr:not(:last-child){
  border-bottom:1px solid rgba(255,255,255,.08);
}

.green{color:#4dff88;}
.red{color:#ff5c5c;}
.gray{color:#aaa;}

.decision{
  margin-top:16px;
  padding:14px;
  border-radius:12px;
  background:rgba(0,0,0,.35);
  text-align:center;
}

.badge{
  display:inline-block;
  padding:6px 12px;
  border-radius:20px;
  font-weight:bold;
  margin:6px;
}

.ce{background:#123d2a;color:#4dff88;}
.pe{background:#3d1212;color:#ff5c5c;}
.neutral{background:#333;color:#ccc;}

.footer{
  margin-top:10px;
  text-align:center;
  font-size:12px;
  color:#999;
}
</style>
</head>

<body>

<div class="card">
  <h1>Greeks</h1>

  <table>
    <thead>
      <tr>
        <th>Greeks</th>
        <th>CALL</th>
        <th>PUT</th>
        <th>DIFF</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Delta</td>
        <td id="ceDelta">--</td>
        <td id="peDelta">--</td>
        <td id="deltaDiff">--</td>
      </tr>
      <tr>
        <td>Vega</td>
        <td id="ceVega">--</td>
        <td id="peVega">--</td>
        <td id="vegaDiff">--</td>
      </tr>
      <tr>
        <td>Gamma</td>
        <td id="ceGamma">--</td>
        <td id="peGamma">--</td>
        <td id="gammaDiff">--</td>
      </tr>
      <tr>
        <td>Theta</td>
        <td id="ceTheta">--</td>
        <td id="peTheta">--</td>
        <td id="thetaDiff">--</td>
      </tr>
    </tbody>
  </table>

  <div class="decision" id="decisionBox">
    Loading…
  </div>

  <div class="footer">Auto refresh • 5 sec</div>
</div>

<script>
async function loadGreeks(){
  try{
    const res = await fetch("/api/greeks");
    const data = await res.json();

    const ce = data.CE;
    const pe = data.PE;

    const deltaDiff = ce.delta - Math.abs(pe.delta);
    const thetaDiff = pe.theta - ce.theta;
    const vegaDiff  = ce.vega - pe.vega;
    const gammaDiff = ce.gamma - pe.gamma;

    document.getElementById("ceDelta").innerText = ce.delta.toFixed(2);
    document.getElementById("peDelta").innerText = pe.delta.toFixed(2);
    document.getElementById("deltaDiff").innerText = deltaDiff.toFixed(2);

    document.getElementById("ceVega").innerText = ce.vega.toFixed(2);
    document.getElementById("peVega").innerText = pe.vega.toFixed(2);
    document.getElementById("vegaDiff").innerText = vegaDiff.toFixed(2);

    document.getElementById("ceGamma").innerText = ce.gamma.toFixed(4);
    document.getElementById("peGamma").innerText = pe.gamma.toFixed(4);
    document.getElementById("gammaDiff").innerText = gammaDiff.toFixed(4);

    document.getElementById("ceTheta").innerText = ce.theta.toFixed(2);
    document.getElementById("peTheta").innerText = pe.theta.toFixed(2);
    document.getElementById("thetaDiff").innerText = thetaDiff.toFixed(2);

    let decisionHTML = "";
    if(deltaDiff > 0 && thetaDiff > 0){
      decisionHTML = `<span class="badge ce">CE BIAS</span><br>Delta + Theta aligned`;
    }else if(deltaDiff < 0 && thetaDiff < 0){
      decisionHTML = `<span class="badge pe">PE BIAS</span><br>Delta + Theta aligned`;
    }else{
      decisionHTML = `<span class="badge neutral">NO TRADE</span><br>Mixed signals`;
    }

    document.getElementById("decisionBox").innerHTML = decisionHTML;

  }catch(e){
    document.getElementById("decisionBox").innerText = "API Error";
  }
}

loadGreeks();
setInterval(loadGreeks,5000);
</script>

</body>
</html>
