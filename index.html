<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>NSE Greeks – AOC Style</title>

<style>
  body {
    margin: 0;
    height: 100vh;
    background: radial-gradient(circle at top, #0b1a33, #050b18);
    font-family: Arial, sans-serif;
    color: #e5e7eb;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .card {
    width: 420px;
    background: linear-gradient(180deg, #0f1f3d, #0a1226);
    border-radius: 18px;
    padding: 22px;
    box-shadow: 0 0 40px rgba(0,0,0,0.6);
  }

  h1 {
    text-align: center;
    color: #6fb6ff;
    margin-bottom: 14px;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 16px;
  }

  th, td {
    padding: 8px;
    border-bottom: 1px solid #1f2a44;
    text-align: center;
    font-size: 14px;
  }

  th {
    color: #93c5fd;
  }

  .green { color: #22c55e; }
  .red { color: #ef4444; }
  .neutral { color: #9ca3af; }

  .decision {
    margin-top: 14px;
    padding: 14px;
    border-radius: 14px;
    text-align: center;
    background: #020617;
  }

  .decision.ce { background: linear-gradient(180deg,#14532d,#052e16); }
  .decision.pe { background: linear-gradient(180deg,#7f1d1d,#450a0a); }
  .decision.wait { background: linear-gradient(180deg,#1e293b,#020617); }

  .badge {
    display: inline-block;
    padding: 6px 18px;
    border-radius: 20px;
    font-weight: bold;
    margin-bottom: 6px;
  }

  .badge.ce { background:#22c55e; color:#022c22; }
  .badge.pe { background:#ef4444; color:#450a0a; }
  .badge.wait { background:#64748b; }

  .prob {
    font-size: 13px;
    margin-top: 4px;
    opacity: 0.9;
  }

  .footer {
    margin-top: 10px;
    font-size: 12px;
    text-align: center;
    color: #9ca3af;
  }
</style>
</head>

<body>

<div class="card">
  <h1>Greeks</h1>

  <table>
    <thead>
      <tr>
        <th>Greeks</th>
        <th>CALL</th>
        <th>PUT</th>
        <th>DIFF</th>
      </tr>
    </thead>
    <tbody id="rows"></tbody>
  </table>

  <div id="decisionBox" class="decision wait">
    <div class="badge wait">WAIT</div>
    <div id="decisionText">No clear alignment</div>
    <div class="prob" id="probText"></div>
  </div>

  <div class="footer">Auto refresh • 5 sec</div>
</div>

<script>
async function loadGreeks() {
  const res = await fetch('/api/greeks');
  const data = await res.json();

  const CE = data.CE;
  const PE = data.PE;

  const deltaDiff = CE.delta - Math.abs(PE.delta);
  const thetaDiff = PE.theta - CE.theta;

  const rows = [
    ['Delta', CE.delta, PE.delta, deltaDiff],
    ['Vega', CE.vega, PE.vega, CE.vega - PE.vega],
    ['Gamma', CE.gamma, PE.gamma, CE.gamma - PE.gamma],
    ['Theta', CE.theta, PE.theta, thetaDiff]
  ];

  const tbody = document.getElementById('rows');
  tbody.innerHTML = '';

  rows.forEach(r => {
    const tr = document.createElement('tr');

    tr.innerHTML = `
      <td>${r[0]}</td>
      <td class="${r[1] > 0 ? 'green' : 'red'}">${r[1].toFixed(2)}</td>
      <td class="${r[2] > 0 ? 'green' : 'red'}">${r[2].toFixed(2)}</td>
      <td class="${r[3] > 0 ? 'green' : r[3] < 0 ? 'red' : 'neutral'}">
        ${r[3].toFixed(2)}
      </td>
    `;
    tbody.appendChild(tr);
  });

  const box = document.getElementById('decisionBox');
  const badge = box.querySelector('.badge');
  const text = document.getElementById('decisionText');
  const prob = document.getElementById('probText');

  let ceScore = Math.max(deltaDiff, 0) + Math.max(thetaDiff, 0);
  let peScore = Math.max(-deltaDiff, 0) + Math.max(-thetaDiff, 0);
  let total = ceScore + peScore || 1;

  let cePct = Math.round((ceScore / total) * 100);
  let pePct = 100 - cePct;

  if (ceScore > peScore && ceScore > 0) {
    box.className = 'decision ce';
    badge.className = 'badge ce';
    badge.textContent = 'CE BIAS';
    text.textContent = 'Delta + Theta aligned';
  } else if (peScore > ceScore && peScore > 0) {
    box.className = 'decision pe';
    badge.className = 'badge pe';
    badge.textContent = 'PE BIAS';
    text.textContent = 'Delta + Theta aligned';
  } else {
    box.className = 'decision wait';
    badge.className = 'badge wait';
    badge.textContent = 'NO TRADE';
    text.textContent = 'Conflicting Greeks';
  }

  prob.textContent = `CE: ${cePct}% | PE: ${pePct}%`;
}

loadGreeks();
setInterval(loadGreeks, 5000);
</script>

</body>
</html>
