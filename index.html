<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>NSE Greeks</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  background:radial-gradient(circle at top,#0b1833,#050b18);
  font-family:Arial,Helvetica,sans-serif;
  color:#e5e7eb;
}

.panel{
  width:430px;
  background:linear-gradient(180deg,#0f1c36,#0a1226);
  border-radius:18px;
  padding:26px;
  box-shadow:0 0 50px rgba(0,0,0,.7);
}

h1{
  text-align:center;
  color:#60a5fa;
  margin:0 0 18px;
}

table{
  width:100%;
  border-collapse:collapse;
  font-size:15px;
}

th,td{
  padding:10px;
  text-align:center;
}

th{
  color:#93c5fd;
  border-bottom:1px solid #1f2a44;
}

td{
  border-bottom:1px solid #1f2a44;
}

.left{
  text-align:left;
}

.green{color:#22c55e;}
.red{color:#ef4444;}
.gray{color:#9ca3af;}

.decision{
  margin-top:18px;
  padding:18px;
  background:linear-gradient(180deg,#0b1328,#070d1a);
  border-radius:14px;
  text-align:center;
  box-shadow:inset 0 0 20px rgba(0,0,0,.6);
}

.badge{
  display:inline-block;
  padding:8px 20px;
  border-radius:999px;
  font-weight:bold;
  margin-bottom:8px;
}

.badge.ce{background:#16a34a;}
.badge.pe{background:#dc2626;}
.badge.none{background:#374151;}

.sub{
  font-size:14px;
  color:#d1d5db;
}

.prob{
  margin-top:6px;
  font-size:14px;
  color:#e5e7eb;
}

.footer{
  margin-top:14px;
  text-align:center;
  font-size:12px;
  color:#6b7280;
}
</style>
</head>

<body>

<div class="panel">
  <h1>Greeks</h1>

  <table>
    <thead>
      <tr>
        <th class="left">Greeks</th>
        <th>CALL</th>
        <th>PUT</th>
        <th>DIFF</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td class="left">Delta</td>
        <td id="ceDelta"></td>
        <td id="peDelta"></td>
        <td id="deltaDiff"></td>
      </tr>
      <tr>
        <td class="left">Vega</td>
        <td id="ceVega"></td>
        <td id="peVega"></td>
        <td id="vegaDiff"></td>
      </tr>
      <tr>
        <td class="left">Gamma</td>
        <td id="ceGamma"></td>
        <td id="peGamma"></td>
        <td id="gammaDiff"></td>
      </tr>
      <tr>
        <td class="left">Theta</td>
        <td id="ceTheta"></td>
        <td id="peTheta"></td>
        <td id="thetaDiff"></td>
      </tr>
    </tbody>
  </table>

  <div class="decision">
    <div id="biasBadge" class="badge none">NO TRADE</div>
    <div id="biasText" class="sub">Waiting for alignment</div>
    <div id="probText" class="prob"></div>
  </div>

  <div class="footer">Auto refresh â€¢ 5 sec</div>
</div>

<script>
async function load(){
  const r = await fetch('/api/greeks');
  const d = await r.json();

  const CE = d.CE;
  const PE = d.PE;

  const deltaDiff = CE.delta - Math.abs(PE.delta);
  const thetaDiff = PE.theta - CE.theta;

  function set(id,val,good){
    const e=document.getElementById(id);
    e.textContent=val.toFixed(2);
    e.className=good?'green':'red';
  }

  set('ceDelta',CE.delta,CE.delta>0);
  set('peDelta',PE.delta,PE.delta<0);
  set('deltaDiff',deltaDiff,deltaDiff>0);

  set('ceVega',CE.vega,true);
  set('peVega',PE.vega,true);
  set('vegaDiff',CE.vega-PE.vega,Math.abs(CE.vega-PE.vega)<1);

  set('ceGamma',CE.gamma,true);
  set('peGamma',PE.gamma,true);
  set('gammaDiff',CE.gamma-PE.gamma,Math.abs(CE.gamma-PE.gamma)<0.001);

  set('ceTheta',CE.theta,CE.theta<0);
  set('peTheta',PE.theta,PE.theta<0);
  set('thetaDiff',thetaDiff,thetaDiff>0);

  let bias='none';
  let ceProb=50, peProb=50;
  let text='No clear edge';

  if(deltaDiff>0 && thetaDiff>0){
    bias='ce';
    text='Delta + Theta aligned';
    ceProb=60; peProb=40;
  }
  if(deltaDiff<0 && thetaDiff<0){
    bias='pe';
    text='Delta + Theta aligned';
    ceProb=40; peProb=60;
  }

  const badge=document.getElementById('biasBadge');
  badge.className='badge '+bias;
  badge.textContent=bias==='ce'?'CE BIAS':bias==='pe'?'PE BIAS':'NO TRADE';

  document.getElementById('biasText').textContent=text;
  document.getElementById('probText').textContent=`CE: ${ceProb}% | PE: ${peProb}%`;
}

load();
setInterval(load,5000);
</script>

</body>
</html>
